--TRUNCATE TABLE USER;
DROP TABLE IF EXISTS USER CASCADE;
DROP TABLE IF EXISTS AUTHORITY CASCADE;

--DROP SEQUENCE IF EXISTS USER_SEQ;

CREATE SEQUENCE USER_SEQ START WITH 1 INCREMENT BY 1;


--GENERATED BY DEFAULT AS SEQUENCE USER_SEQ
--NEXTVAL(USER_SEQ)
CREATE TABLE USER (
	ID          BIGINT GENERATED BY DEFAULT AS SEQUENCE USER_SEQ,
	USERNAME	VARCHAR(255) NOT NULL,
	PASSWORD	VARCHAR(255) NOT NULL,
	ENABLED		BOOLEAN DEFAULT TRUE NOT NULL
);
ALTER TABLE USER ADD CONSTRAINT USER_PK PRIMARY KEY (ID);
CREATE UNIQUE INDEX USER_UNQ ON USER (USERNAME);
ALTER TABLE USER ADD CONSTRAINT USER_CK_USERNAME CHECK(LENGTH(TRIM(USERNAME)) > 0);
ALTER TABLE USER ADD CONSTRAINT USER_CK_PASSWORD CHECK(LENGTH(TRIM(PASSWORD)) > 0);
COMMENT ON TABLE USER IS 'Tabelle für USER';
COMMENT ON COLUMN USER.ID IS 'Primary Key';


CREATE TABLE AUTHORITY (
	USERNAME	VARCHAR(255) NOT NULL,
	ROLE 		VARCHAR(255) NOT NULL
);
CREATE UNIQUE INDEX AUTHORITY_UNQ ON AUTHORITY (USERNAME, ROLE);
CREATE INDEX AUTHORITY_IDX_USERNAME ON AUTHORITY (USERNAME);
ALTER TABLE AUTHORITY ADD CONSTRAINT AUTHORITY_CK_USERNAME CHECK(LENGTH(TRIM(USERNAME)) > 0);
ALTER TABLE AUTHORITY ADD CONSTRAINT AUTHORITY_CK_ROLE CHECK(LENGTH(TRIM(ROLE)) > 0);
COMMENT ON TABLE AUTHORITY IS 'Tabelle für AUTHORITIES';
COMMENT ON COLUMN AUTHORITY.USERNAME IS 'FOREIGN KEY auf USER.USERNAME';
