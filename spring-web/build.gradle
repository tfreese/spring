plugins {
    id("java")
    id("org.springframework.boot")
}

description = "Demo f√ºr spring-boot-web mit JSF"

dependencies {
    modules {
        module("org.springframework.boot:spring-boot-starter-logging") {
            replacedBy("org.springframework.boot:spring-boot-starter-log4j2", "Use Log4j2 instead of Logback")
        }
    }

    // With Joinfaces: 77 Dependencies and 41,81MB.
    // implementation("org.joinfaces:primefaces-spring-boot-starter")

    // Without Joinfaces: 73 Dependencies and 45,41MB.
    implementation("org.glassfish:jakarta.faces")
    // implementation("jakarta.platform:jakarta.jakartaee-api")
    // implementation("jakarta.platform:jakarta.jakartaee-web-api")
    implementation("jakarta.faces:jakarta.faces-api")
    // implementation("org.jboss.weld.servlet:weld-servlet-shaded") // CDI
    implementation("org.jboss.weld.servlet:weld-servlet-core") // CDI
    runtimeOnly("org.apache.tomcat.embed:tomcat-embed-jasper")
    runtimeOnly("org.primefaces:primefaces::jakarta")
    runtimeOnly("org.primefaces:primefaces-themes")
    runtimeOnly("org.primefaces.extensions:primefaces-extensions::jakarta")


    implementation("org.springframework.boot:spring-boot-starter-web")
    implementation("software.xdev:chartjs-java-model")

    runtimeOnly("org.springframework.boot:spring-boot-devtools")
    runtimeOnly("org.springframework.boot:spring-boot-starter-actuator")
    runtimeOnly("org.springframework.boot:spring-boot-starter-log4j2")
}

// Start: gradle bootRun --args="--spring.profiles.active=dev"
springBoot {
    mainClass = "de.freese.spring.web.SpringBootWebApplication"
}
// tasks.named("bootJar") {
//     layered {
//         enabled = false
//     }
// }

sourceSets {
    main {
        resources {
            srcDir(layout.projectDirectory.dir("src").dir("main").dir("webapp"))
        }
    }
}

// For Placeholder in Resources.
ext.artifactId = project.name

processResources {
    // def map = project.properties
    def map = [
            "project_description": project.description,
            "project_artifactId" : project.name,
            "project_version"    : project.version
    ]

    // All Files
    // expand(project.properties)

    // filesNotMatching(...) {
    // filesMatching(["**/*.properties", "a.txt", "z.txt"]) {
    filesMatching("application.yml") {
        // filteringCharset = "UTF-8"

        // If Problems escape Placeholder: \${...}
        expand(map)

        // expand ("@project.description@": project.description,
        //		"@project.artifactId@": project.name,
        //		"@project.version@": project.version
        //)

        // filter{ it.replaceAll("@project.description@", project.description)}
        // filter{ it.replaceAll("@project.artifactId@", project.name)}
        // filter{ it.replaceAll("@project.version@", project.version)}

        // // Keeps Windows Line-Endings.
        // filter(org.apache.tools.ant.filters.FixCrLfFilter.class, eol: org.apache.tools.ant.filters.FixCrLfFilter.CrLf.newInstance("crlf"))

        // filter(ReplaceTokens,
        //         tokens: ["project_artifactId": project.artifactId],
        //         beginToken: "@",
        //         endToken: "@"
        // )
    }
}


tasks.register("copyLibs", Copy) {
    group = "spring-web"

    println("build " + project.name)

    into(layout.buildDirectory)

    into("libs") {
        from(configurations.runtimeClasspath)
    }
}
